<!DOCTYPE html>
<html>
  <head>

    <title>Simple Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
  </head>
  <body>
 
    <div id="caption"> C </div> 
  
       <b>Home address: </b>
      <textarea id="addr" name="addr" rows="2" cols="20">Enter your home address </textarea>
      <b>Travel Mode: </b>
       <select id="mode">
        <option value="DRIVING">Driving</option>
        <option value="WALKING">Walking</option>
        <option value="BICYCLING">Bicycling</option>
        <option value="TRANSIT">Transit</option>
      </select>
      <input id="clickMe" type="button" value="Get directions to my billboard." onclick="showDirections();" />
    </div>

  <div id="map" style="width: 1000px; height: 600px;"></div>
  
   
    
   <div id="directions"> </div>
  
  
  
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjIHxRvfEqgJaJEE_cB3MvbgOxekTd7vc&callback=initMap&libraries=&v=weekly" async>  
    </script>
    
    <script>
    let map;
	  var directionsService;
	  var directionsRenderer;
	  var lat;
      var lon;
      var loc;
      
    function initMap() {
    	  directionsService = new google.maps.DirectionsService();
    	  directionsRenderer = new google.maps.DirectionsRenderer();
    	  directionsRenderer.setPanel(document.getElementById("directions"));
    	
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        lat = parseFloat(urlParams.get('lat'));
        lon = parseFloat(urlParams.get('lon'));
        loc = urlParams.get('loc');
        map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: lat , lng: lon },
        zoom: 15,
      });
        directionsRenderer.setMap(map);
        
    const image = "http://localhost:8080/static/diplomavsm.png";
      const beachMarker = new google.maps.Marker({
        position: { lat: lat, lng: lon },
        map,
        icon: image,
      });
     
      
      document.getElementById("caption").innerHTML = "Your graduation billboard is at :" + loc +" <br> ";
    }
    
    function showDirections(){
    	 var dest = lat +"," + lon;
         calculateAndDisplayRoute(directionsService, directionsRenderer,dest);
    }
    
    function calculateAndDisplayRoute(directionsService, directionsRenderer,dest) {
    	const selectedMode = document.getElementById("mode").value;
    	const startAddr = document.getElementById("addr").value;
    	
    	
    	  directionsService.route(
    	    {
    	      origin: {
    	        query: startAddr,
    	      },
    	      destination: {
    	        query: dest,
    	      },
    	      travelMode: google.maps.TravelMode[selectedMode],
    	    },
    	    (response, status) => {
    	      if (status === "OK") {
    	        directionsRenderer.setDirections(response);
    	      } else {
    	        window.alert("I can't find your addrress, please make sure that you have entered it fully.");
    	      }
    	    }
    	  );
    	}

    </script>
    
  </body>
</html>