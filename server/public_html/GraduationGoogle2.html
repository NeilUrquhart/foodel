<!DOCTYPE html>
<html>
<head>
<title>Graduation Map</title>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
</head>
<body>
	<div id="caption"></div>


	<div id="map" style="width: 1000px; height: 600px;"></div>
	<h1>Find and travel to your billboard :</h1>
		<b>Enter your home address: </b>
	<input id="pac-input" type="search" placeholder="Enter your home address " oninput="showDirections();" onblur="showDirections();" onsearch="showDirections();" onchange="showDirections();"size="100" />
	<br>
	<b>Travel Mode: </b>
	<select id="mode"   onChange="showDirections();">
	    <option value="" disabled selected hidden>Please Choose...</option>
		<option value="DRIVING">Driving</option>
		<option value="WALKING">Walking</option>
		<option value="BICYCLING">Cycling</option>
		<option value="TRANSIT">Public Transport</option>
	</select>
	
	
	<div id="directions"></div>

	<!-- Async script executes immediately and must be after any DOM elements used in callback. -->
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjIHxRvfEqgJaJEE_cB3MvbgOxekTd7vc&callback=initMap&libraries=places&v=weekly"
		async>  
    </script>

	<script>
    let map;
	  var directionsService;
	  var directionsRenderer;
	  var lat;
      var lon;
      var loc;
      
    function initMap() {
    	  directionsService = new google.maps.DirectionsService();
    	  directionsRenderer = new google.maps.DirectionsRenderer({suppressMarkers: true});
    	  directionsRenderer.setPanel(document.getElementById("directions"));
    	
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        lat = parseFloat(urlParams.get('lat'));
        lon = parseFloat(urlParams.get('lon'));
        loc = urlParams.get('loc');
        map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: lat , lng: lon},
        zoom: 15,
      });
        directionsRenderer.setMap(map);
        
        const input = document.getElementById("pac-input");
        const options = {
          componentRestrictions: { country: "uk" },
          fields: ["formatted_address", "geometry", "name"],
          origin: map.getCenter(),
          //strictBounds: false,
          //types: ["establishment"],
        };
        const autocomplete = new google.maps.places.Autocomplete(input, options);
        // Bind the map's bounds (viewport) property to the autocomplete object,
        // so that the autocomplete requests use the current map bounds for the
        // bounds option in the request.
        autocomplete.bindTo("bounds", map);
        const infowindow = new google.maps.InfoWindow();
        const infowindowContent = document.getElementById("infowindow-content");
        infowindow.setContent(infowindowContent);
        
    const image = "http://localhost:8080/static/diplomavsm.png";
      const beachMarker = new google.maps.Marker({
        position: { lat: lat, lng: lon },
        map,
        icon: image,
      });
      
      document.getElementById("caption").innerHTML = "<h1>Your graduation billboard is at :" + loc +" </h1><br> ";
    }
    
    function showDirections(){
    	 var dest = lat +"," + lon;
         calculateAndDisplayRoute(directionsService, directionsRenderer,dest);
    }
    
    function calculateAndDisplayRoute(directionsService, directionsRenderer,dest) {
    	const selectedMode = document.getElementById("mode").value;
    	const startAddr = document.getElementById("pac-input").value;
    	
    	
    	  directionsService.route(
    	    {
    	      origin: {
    	        query: startAddr,
    	      },
    	      destination: {
    	        query: dest,
    	      },
    	      travelMode: google.maps.TravelMode[selectedMode],
    	    },
    	    (response, status) => {
    	      if (status === "OK") {
    	        directionsRenderer.setDirections(response);
    	      } 
    	    }
    	  );
    	}
    
 

    </script>

</body>
</html>